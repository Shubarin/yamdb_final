# api_yamdb
![Django-app workflow](https://github.com/Shubarin/yamdb_final/actions/workflows/yamdb_workflow.yaml/badge.svg)
  
Site: http://84.252.132.152/api/v1/

# Описание
Проект **YaMDb** собирает отзывы пользователей на произведения. Произведения делятся на категории: «Книги», «Фильмы», «Музыка».
Сами произведения в YaMDb не хранятся, здесь нельзя посмотреть фильм или послушать музыку.
В каждой категории есть произведения: книги, фильмы или музыка. Например, в категории «Книги» могут быть произведения «Винни Пух и все-все-все» и «Марсианские хроники», а в категории «Музыка» — песня «Давеча» группы «Насекомые» и вторая сюита Баха. Произведению может быть присвоен жанр из списка предустановленных (например, «Сказка», «Рок» или «Артхаус»). Новые жанры может создавать только администратор.
Благодарные или возмущённые читатели оставляют к произведениям текстовые отзывы (Review) и выставляют произведению рейтинг (оценку в диапазоне от одного до десяти). Из множества оценок автоматически высчитывается средняя оценка произведения.

# Порядок установки
## В режиме разработки
1. Установить виртуальный интерпретатор `python3 -m venv venv`

После выполнения этой команды в директории проекта появится папка venv, в которой хранятся служебные файлы виртуального окружения. Там же будут сохранены все зависимости проекта.

2. Ативировать виртуальное окружение в зависимости от операционной системы  
   Unix-системы: `source venv/bin/activate`  
   Windows: `source venv/Scripts/activate`

В терминале появится уведомление о том, что вы работаете в виртуальном окружении: строка  (venv) будет предварять все команды.

3. Установите необходимые пакеты `pip install -r requirements.txt`
4. Запустите приложение в терминале `python manage.py runserver`
## В режиме запуска на сервере
1. Переименуйте файл .evn.example в .env, внесите ваши настройки согласно примеру  
2. Запустите докер  
   ```docker-compose up -d --build```  
3. Создайте необходимые миграции:   
   ```docker-compose exec web python manage.py makemigrations api```
4. Накатите созданные миграции в БД  
```docker-compose exec web python manage.py migrate```
5. Создайте суперпользователя:  
```docker-compose exec web python manage.py createsuperuser```
6. Соберите статику  
```docker-compose exec web python manage.py collectstatic --no-input```
7. Приложение будет доступно по адресу  
```http://127.0.0.1/```
   
# Загрузка тестовых данных  
1. Запустите приложение
   ```docker-compose up -d --build```
2. Откройте терминал сервиса web
   ```docker-compose exec web bash```
3. Выполните последовательно следующий код:
```python3 manage.py shell```
```python
from django.contrib.contenttypes.models import ContentType
ContentType.objects.all().delete()
quit()
```
```python manage.py loaddata fixtures.json```

# Документация API
К проекту по адресу /redoc подключена документация API YaMDb. В ней описаны шаблоны запросов к API и структура ожидаемых ответов. Для каждого запроса указаны уровни прав доступа: пользовательские роли, которым разрешён запрос.

# Ресурсы API YaMDb

1. Ресурс AUTH: аутентификация.
2. Ресурс USERS: пользователи.
3. Ресурс TITLES: произведения, к которым пишут отзывы (определённый фильм, книга или песенка).
4. Ресурс CATEGORIES: категории (типы) произведений («Фильмы», «Книги», «Музыка»).
5. Ресурс GENRES: жанры произведений. Одно произведение может быть привязано к нескольким жанрам.
6. Ресурс REVIEWS: отзывы на произведения. Отзыв привязан к определённому произведению.
7. Ресурс COMMENTS: комментарии к отзывам. Комментарий привязан к определённому отзыву.

Каждый ресурс описан в документации: указаны эндпойнты (адреса, по которым можно сделать запрос), разрешённые типы запросов, права доступа и дополнительные параметры, если это необходимо.

# База данных

В репозитории с заданием в директории /data подготовлены несколько файлов .csv с контентом для Users, Titles, Categories, Genres, Review и Comments. Тестировать пустой проект будет неудобно, а наполнять его руками — долго.